# API
[На главную](README.md)  
Реализованный сервер предоставляет миниатюрное API для будущего взаимодействия с другими сайтами.  
На странице `forms.html` (она же выдаётся по запросам `/` и `/forms`) можно протестировать API, не занимающееся парсингом портфолио.



## Общее описание
Во всех запросах аргументы отправляются просто, без вложенностей друг в друга.
Кроме перечисленных в описаниях параметрах, также нужно отправлять строку `api_key` — ключ доступа к API, выдаваемые автором API.  
Во всех ответах API присылает файл, или используется JSON формат, все возвращаемые параметры находятся в корне (если не указано иного), например:
```json
{"one": 1, "two": 2}
```
Где `"one"` и `"two"` — названия возвращаемых параметров, а `1` и `2` — их значения.



## Получение всех портфолио из [Eljur](https://eljur.ru)
### Начало прасинга
* Метод `start`
* Запрос `POST`
* Параметры запроса: `нет`
* Параметры ответа:

| Параметр | Тип | Описание | Условие |
| ------ | ------ | ------ | ------ |
| status | str | Результат операции (`OK` или `ERROR`) | Всегда |



### Парсинга портфолио одного школьника
* Метод `parse`
* Запрос `POST`
* Параметры запроса:

| Параметр | Тип | Описание | Условие |
| ------ | ------ | ------ | ------ |
| student_id | int | Номер школьника в журнале | Всегда |
| cls | str | Класс школьника слитно (например, `5Т` или `11П`) | Всегда |
| fio | str | ФИО школьника через пробел (например, `Иванов Иван Иванович`) | Всегда |
| educational | str (html) | Результаты учебной деятельности | Всегда |
| olympiads | str (html) | Олимпиады | Всегда |
| contest | str (html) | Конкурсы | Всегда |
| research | str (html) | Исследовательская работа | Всегда |
| elective | str (html) | Элективные курсы | Всегда |
| additional_education_out | str (html) | Дополнительное образование (вне ОУ) | Всегда |
| additional_education_in | str (html) | Дополнительное образование (в ОУ) | Всегда |
| sport | str (html) | Спортивные достижения | Всегда |
| other_olympiads | str (html) | Прочие олимпиады | Всегда |
| events_in | str (html) | Мероприятия (в ОУ) | Всегда |
| events_out | str (html) | Мероприятия (вне ОУ) | Всегда |
| sport_out | str (html) | Спорт (вне ОУ) | Всегда |
| creativity_out | str (html) | Творчество (вне ОУ) | Всегда |

* Параметры ответа:

| Параметр | Тип | Описание | Условие |
| ------ | ------ | ------ | ------ |
| status | str | Результат операции (`OK` или `ERROR`) | Всегда |



### Конец парсинга
* Метод `end`
* Запрос `POST`
* Параметры запроса: `нет`
* Параметры ответа:

| Параметр | Тип | Описание | Условие |
| ------ | ------ | ------ | ------ |
| — | Файл EXCEL | Данные парсинга | При успехе |
| status | str | Результат операции (`ERROR`) | При неудаче |



## Данные из Excel
### Очистка данных
* Метод `clear`
* Запрос `POST`
* Параметры запроса: `нет`
* Параметры ответа:

| Параметр | Тип | Описание | Условие |
| ------ | ------ | ------ | ------ |
| status | str | Результат операции (`OK` или `ERROR`) | Всегда |



### Загрузка данных из Excel
* Метод `parse_excel`
* Запрос `POST`
* Параметры запроса:

| Параметр | Тип | Описание | Условие |
| ------ | ------ | ------ | ------ |
| excel | file (excel) | Таблица с данными по описанию ниже | Всегда |

* Параметры ответа:

| Параметр | Тип | Описание | Условие |
| ------ | ------ | ------ | ------ |
| status | str | Результат операции (`OK` или `ERROR`) | Всегда |
| excel_errors | list | Список возникших ошибок в таблице | Всегда |
| eljur_errors | list | Список возникших ошибок в БД | Всегда |

* Описание таблицы (файл `excel` запроса)
  * Лист — `список`.
  * ФИО — столбец `имя` (через пробел фамилия, имя и отчество).
  * Класс школьника — столбец `класс` (слитно, например, `5Т` или `11П`).
  * Пол школьника — столбец `пол` (одна буква `м` или `ж`)
  * Названия столбцов и листа проверяются не строго, берётся первое, где указанное слово встретится.

* Описание ошибки (элемент из `excel_errors` и `eljur_errors` ответа):

| Параметр | Тип | Описание |
| ------ | ------ | ------ |
| lastname | str | Фамилия ребёнка |
| firstname | str | Имя ребёнка |
| middlename | str | Отчество ребёнка |
| class_n | int | Номер класса (параллель) |
| class_l | str | Буква класса (вертикаль) |
| message | str | Текстовое описание ошибки |

* Текстовые описания ошибок:
  * `Найдено несколько человек` — к человеку из Excel подошло несколько человек из БД (`excel_errors`).
  * `Человек не найден` — к человеку из Excel не подошло никто из БД (`excel_errors`).
  * `Не найден в таблице` — человек из БД остался без пола (`eljur_errors`)
  * Все сравнения происходят по ФИО и классу



## Вход на другие сайты через журнал
* Метод `login`
* Запрос `POST`
* Параметры запроса:

| Параметр | Тип | Описание | Условие |
| ------ | ------ | ------ | ------ |
| login | str | Логин пользователя | Всегда |
| password | str | Пароль пользователя | Всегда |

* Параметры ответа:

| Параметр | Тип | Описание | Условие |
| ------ | ------ | ------ | ------ |
| status | str | Результат входа на сайт (`OK` или `ERROR`) | Всегда |
| lastname | str | Фамилия пользователя | status = `OK` |
| firstname | str | Имя пользователя | status = `OK` |
| middlename | str | Отчество пользователя | status = `OK` |
| eljur_id | int | Номер пользователя в журнале | status = `OK` |
| gender | int | Пол пользователя | status = `OK` |
| teacher | bool | Есть ли роль учителя | status = `OK` |
| administrator | bool | Есть ли роль администратора | status = `OK` |
| sysadmin | bool | Есть ли роль системного администратора | status = `OK` |
| childs | list | Список детей, каждый по описанию ниже | status = `OK` |

* Описание ребёнка (элемент из `childs` ответа):

| Параметр | Тип | Описание |
| ------ | ------ | ------ |
| lastname | str | Фамилия ребёнка |
| firstname | str | Имя ребёнка |
| middlename | str | Отчество ребёнка |
| gender | int | Пол ребёнка |
| class_n | int | Номер класса (параллель) |
| class_l | str | Буква класса (вертикаль) |
| eljur_id | int | Номер ребёнка в журнале |

* Пример ответа:

```json
{
  "status": "OK",
  "lastname": "Иванов",
  "firstname": "Иван",
  "middlename": "Иванович",
  "eljur_id": 123456,
  "gender": 1,
  "teacher": true,
  "administrator":  false,
  "sysadmin":  false,
  "childs": [
    {
      "lastname": "Иванова",
      "firstname": "Екатерина",
      "middlename": "Ивановна",
      "gender": 2,
      "class_n": 1,
      "class_l": "Т",
      "eljur_id": 654321
    }
  ]
}
```

* Параметр `пол`:
  * `0` — не известен
  * `1` — мужской
  * `2` — женский

